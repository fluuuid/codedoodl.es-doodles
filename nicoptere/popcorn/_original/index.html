<html>
	<title>Nicoptere - Popcorn</title>
	<style>
		head, body{ width: 100%; height: 100%; overflow: hidden; top: 0; left: 0; margin: 0; padding: 0; } canvas{position:absolute;top:0;left:0;}
	</style>
	<script>
	function interpolateColorsCompact(t,i,s){var n=16711935,a=65280,e=parseInt(256*s),h=256-e;return(t&n)*h+(i&n)*e>>8&n|(t&a)*h+(i&a)*e>>8&a}function update(){requestAnimationFrame(update),pop.update(),Date.now()>time&&(time=Date.now()+deltaTime,pop.reset())}var PopCornDef=function(t,i,s){null==t&&(t=.1),null==i&&(i=50),null==s&&(s=0),this.fcid=0,this.color=0,this.K=0,this.Y=0,this.X=0,this.H=t,this.S=i,this.lastIteration=0,this.color=s,this.fcs=[this.fc0.bind(this),this.fc1.bind(this),this.fc2.bind(this),this.fc3.bind(this),this.fc4.bind(this)],PopCornDef.increment=.01,PopCornDef.iterations=10,this.reset()};PopCornDef.prototype={fc4:function(t,i){this.X=t-this.H*Math.cos(i+Math.cos(this.A*i)),this.Y=i-this.H*Math.sin(t+Math.sin(this.B*t))},fc3:function(t,i){this.X=t-this.H*Math.sin(i+Math.cos(this.A*i)),this.Y=i-this.H*Math.sin(t+Math.cos(this.B*t))},fc2:function(t,i){this.X=t-this.H*Math.sin(i+Math.sin(this.A*i)),this.Y=i-this.H*Math.sin(t+Math.sin(this.B*t))},fc1:function(t,i){this.X=t-this.H*Math.sin(i+Math.sin(this.A*i+Math.sin(this.A*i))),this.Y=i-this.H*Math.sin(t+Math.sin(this.B*t+Math.sin(this.B*t)))},fc0:function(t,i){this.A=this.B=3,this.X=t-this.H*Math.sin(i+Math.tan(this.A*i)),this.Y=i-this.H*Math.sin(this.X+Math.tan(this.B*this.X))},update:function(){var t,i,s=0,n=0;for(this.K=this.lastIteration,this.lastIteration>20*PopCornDef.iterations&&(this.lastIteration=0,this.reset(!0),PopCornDef.offset.x=Math.random()*w,PopCornDef.offset.y=Math.random()*h);this.K<this.lastIteration+PopCornDef.iterations;)this.fcs[this.fcid](this.X,this.Y),this.X=this.X<-this.S_MAX?this.S_MAX:this.X%this.S_MAX,this.Y=this.Y<-this.S_MAX?this.S_MAX:this.Y%this.S_MAX,t=(PopCornDef.offset.x+this.X*this.S|0)%w,i=(PopCornDef.offset.y+this.Y*this.S|0)%h,0!=s&&0!=n&&Math.abs(s-t)<this.S&&Math.abs(n-i)<this.S&&Bresenham.lineTo(s,n,t,i,data,w,this.color),s=t,n=i,this.K+=PopCornDef.increment;this.lastIteration+=PopCornDef.iterations},reset:function(t){null==t&&(t=!1),this.X=1e-6*(Math.random()-.5),this.Y=1e-6*(Math.random()-.5),this.A=3,this.B=3,this.lastIteration=0,t&&(this.S=10+50*Math.random(),this.A=Math.round(10*(Math.random()-.5)),this.B=Math.round(10*(Math.random()-.5))),this.S_MAX=.5*this.S}};var Batch=function(){this.colors=[13057293,13056779,15910213,9932355,3474952],this.bgs=[13056779,15910213,9932355,3474952,13057293],this.pops=[new PopCornDef(.1,138),new PopCornDef(.05,62),new PopCornDef(.02,100),new PopCornDef(.02,100)],this.reset(),this.bgTime=0};Batch.prototype={update:function(){if(this.bgTime<1){var t=this.bgs[0],i=this.bgs[1],s=interpolateColorsCompact(i,t,this.bgTime);this.bgTime+=.05,this.bgTime=Math.min(1,Math.max(this.bgTime,0)),bg.fillStyle="rgb("+(s>>16&255)+","+(s>>8&255)+","+(255&s).toString(16)+")",bg.fillRect(0,0,1,1)}this.pops.forEach(function(t){t.update()}),imgData.data=data,ctx.putImageData(imgData,0,0)},reset:function(){this.bgs.unshift(this.bgs.pop()),this.bgTime=0;var t=this;this.pops.forEach(function(i){i.color=t.colors[0],t.colors.push(t.colors.shift()),i.fcid=0,i.reset(!0)}),PopCornDef.offset=new Point(.5*w,.5*h),imgData=ctx.getImageData(0,0,w,h),data=imgData.data;for(var i=3;i<data.length;i+=4)data[i]=parseInt(.5*data[i])}};var Point=function(t,i){this.x=t,this.y=i},Bresenham={};Bresenham.lineTo=function(t,i,s,n,a,e,h){for(var o,r=Math.abs(s-t),c=Math.abs(n-i),f=r-c,p=s>t?1:-1,d=n>i?1:-1,m=h>>16&255,u=h>>8&255,l=255&h;;){var g=4*(t+i*e);if(o=a[g+3]+4,255>=o&&(a[g]=m,a[g+1]=u,a[g+2]=l,a[g+3]=255&(o>255?255:o)),t==s&&i==n)break;var b=2*f;b>-c&&(f-=c,t+=p),r>b&&(f+=r,i+=d)}},function(t){!function(){if(!t.requestAnimationFrame){t.webkitRequestAnimationFrame&&(t.requestAnimationFrame=t.webkitRequestAnimationFrame,t.cancelAnimationFrame=t.webkitCancelAnimationFrame||t.webkitCancelRequestAnimationFrame);var i=0;t.requestAnimationFrame=function(s){var n=(new Date).getTime(),a=Math.max(0,16-(n-i)),e=t.setTimeout(function(){s(n+a)},a);return i=n+a,e},t.cancelAnimationFrame=function(t){clearTimeout(t)}}}(),"function"==typeof define&&define(function(){return t.requestAnimationFrame})}(window),window.onresize=function(){canvas.width=w=window.innerWidth,canvas.height=h=window.innerHeight,bg_canvas.style.width=w+"px",bg_canvas.style.height=h+"px",pop.reset()};var w,h,canvas,ctx,time,pop,bg_canvas,bg,deltaTime=15e3;window.onload=function(){bg_canvas=document.createElement("canvas"),document.body.appendChild(bg_canvas),bg_canvas.width=1,bg_canvas.height=1,bg=bg_canvas.getContext("2d"),canvas=document.createElement("canvas"),document.body.appendChild(canvas),w=canvas.width=window.innerWidth,h=canvas.height=window.innerHeight,ctx=canvas.getContext("2d"),bg_canvas.style.width=w+"px",bg_canvas.style.height=h+"px",pop=new Batch(ctx),pop.reset(),pop.bgTime=.99,ctx.canvas.addEventListener("mousedown",pop.reset.bind(pop)),ctx.canvas.addEventListener("touchstart",pop.reset.bind(pop)),time=Date.now()+deltaTime,update()};
	</script>
	<body></body>
</html>